#!/usr/bin/env bash


# This file is part of mydot.

# mydot is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.

# mydot is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.

# You should have received a copy of the GNU General Public License
# along with mydot.  If not, see <https://www.gnu.org/licenses/>.

# Copyright (c) 2020-2021, Maciej BarÄ‡ <xgqt@protonmail.com>
# Licensed under the GNU GPL v3 License

# Try out python pkgs in tmpfs


set -e


try_out() {

    # Create a virtual env
    virt_dir="/tmp/${1}-$(date +"%Y-%m-%d-%H-%M")"
    mkdir "${virt_dir}"
    python3 -m venv "${virt_dir}"
    # shellcheck disable=SC1090
    . "${virt_dir}"/bin/activate

    # Upgrade pip
    pip install --upgrade pip

    # Install
    pip install "${1}"

    # Open python shell
    echo "import ${1}" >> "${virt_dir}"/pythonstartup
    export  PYTHONSTARTUP="${virt_dir}"/pythonstartup
    python

    # Destroy env
    rm -rfd "${virt_dir}"
}


# No exact search option in pip?
# Dunno... I pipe it into grep to match
# anything on the start of the line & followed by
# a space after the name before the version number
pip search "${1}" | grep "^${1} "

echo "Want to try it out? [y/n]"
read -r answer
case ${answer}
in
    "" | [Yy]* )
        try_out "${1}"
        ;;
    [Nn]* )
        exit
        ;;
    * )
        echo "Please answer yes or no"
        exit 1
        ;;
esac
