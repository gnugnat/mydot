#!/bin/sh

# Noninteractive auto-backup
# script for portage

set -e
export PATH

pbak=portage-$(date +"%Y-%m-%d")

mkdir "$pbak"

cp -r /etc/portage "$pbak/"
rm "$pbak/portage/make.profile"

cp /var/lib/portage/world "$pbak/"
cp /var/lib/portage/world_sets "$pbak/"

tree -a -L 2 /etc/portage > "$pbak/layout"

emerge --info > "$pbak/info"

tar zcf "$pbak.tar.gz" "$pbak" --remove-files
