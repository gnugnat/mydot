#!/usr/bin/env bash


# This file is part of mydot.

# mydot is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.

# mydot is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.

# You should have received a copy of the GNU General Public License
# along with mydot.  If not, see <https://www.gnu.org/licenses/>.

# Copyright (c) 2021, Maciej Barć <xgqt@protonmail.com>
# Licensed under the GNU GPL v3 License


trap 'exit 128' INT
set -e
export PATH


usage() {
    cat << USAGE
Usage: new-ppr NAME
create new research paper environment

Options:
    -h  show this help message

Copyright (c) 2021, Maciej Barć <xgqt@protonmail.com>
Licensed under the GNU GPL v3 License
USAGE
}

main() {
    pd="paper-${*// /_}"

    mkdir "${pd}"
    cd "${pd}"


    # Prepare

    local create=(
        out/doc
        out/pdf
        ppr/doc
        ppr/pdf
        res/doc
        res/notes
        res/org
        res/tex
        src
        sys/linux
    )

    for c in "${create[@]}"
    do
        mkdir -p "${c}"
        touch "${c}/.keep"
    done

    uname -a > sys/linux/uname.txt


    # Venv

    python -m venv .


    # Git

    cat >> .gitignore << GITIGNORE
*.cover
*.egg
*.egg-info/
*.log
*.manifest
*.mo
*.pot
*.py,cover
*.py[cod]
*.sage.py
*.so
*.spec
*.swp
*~
,*
.Python
.cache
.coverage
.coverage.*
.dmypy.json
.eggs/
.env
.hypothesis/
.idea/
.installed.cfg
.ipynb_checkpoints
.mypy_cache/
.nox/
.pybuilder/
.pyre/
.pytest_cache/
.pytype/
.ropeproject
.scrapy
.spyderproject
.spyproject
.tox/
.venv
.vscode/
.webassets-cache
.~lock.*
/bin/
/include/
/lib/
/lib64
/lib64/
/site
ENV/
MANIFEST
__pycache__/
__pypackages__/
build/
celerybeat-schedule
celerybeat.pid
cover/
coverage.xml
cython_debug/
db.sqlite3
db.sqlite3-journal
develop-eggs/
dist/
dmypy.json
docs/_build/
downloads/
eggs/
env.bak/
env/
htmlcov/
instance/
ipython_config.py
local_settings.py
nosetests.xml
parts/
pip-delete-this-directory.txt
pip-log.txt
profile_default/
sdist/
share/python-wheels/
target/
var/
venv.bak/
venv/
wheels/
GITIGNORE

    git init
    git add .
    git commit -m "initial" --signoff
}


case "${1}"
in
    -h | -help | --help )
        usage
        exit 0
    ;;
    "" )
        echo "Provide at least 1 argument."
        usage
        exit 1
    ;;
esac


main "${*}"
